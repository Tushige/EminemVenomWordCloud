<!DOCTYPE html>
<html>
<head>
  <title>pies</title>
  <script src="./d3/d3.js"></script>
  <script src="./d3/d3.layout.cloud.js"></script>
  <style>
    body {
      background: black;
    }
  </style>
</head>
<body>
  <script>
    const dataSource = './venom.txt';

    var color = d3.scaleLinear()
            .domain([0,1,2,3,4,5,6,10,15,20,100])
            .range(["#ddd", "#ccc", "#bbb", "#aaa", "#999", "#888", "#777", "#666", "#555", "#444", "#333", "#222"]);

    d3.text(dataSource)
    .then(function(lyrics) {
      var words = lyrics.split(' ');
      var frequencyTable = {};
      words.forEach(word => {
        if (!frequencyTable[word]) {
          frequencyTable[word] = 0;
        }
        frequencyTable[word]++;
      });
      var arrWords = Object.entries(frequencyTable);
      arrWords = arrWords.map(arr => {
        return {
          text: arr[0],
          size: arr[1]
        };
      });
      var fontScale = d3.scaleLinear()
                      .domain([
                        d3.min(arrWords, function(d) {
                          return d.size;
                        }),
                        d3.max(arrWords, function(d) {
                          return d.size;
                        })
                      ])
                      .range([
                        1,
                        98
                      ]);
      var dummyWords = [
        {text: 'hello', size: 10},
        {text: 'hello2', size: 15},
        {text: 'hello3', size: 20},
      ]
      d3.layout.cloud().size([850, 350])
        .words(dummyWords)
        .rotate(0)
        .fontSize(function(word) {
          return word.size;
        })
        .on('word', function(word) {
        })
        .on('end', draw)
        .start();

      function draw (words) {
        var w = 850,
            h = 350;
        var svg = d3.select('body')
                    .append('svg')
                    .attr('width', w)
                    .attr('height', h);
        svg.append('g')
          // .attr("transform", "translate(320,200)")
          .selectAll('text')
          .data(words)
          .enter()
          .append('text')
          .style('font-size', function(d) {
            return d.size*10 + 'px';
          })
          .style("fill", function(d, i) {
            return color(i);
          })
          .attr("transform", function(d) {
            console.log(d)
              // return "translate(" + [d.x, d.height] + ")rotate(" + d.rotate + ")";
          })
          .text(function(d) {
            return d.text;
          })
      }
    });
  </script>
</body>
</html>
